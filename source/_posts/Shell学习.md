# Shell脚本编程概述

## 第一个Shell脚本例子

​	对于一般的Shell脚本而言，解释器是bash，也可以是sh，即用下面的两种方式作为脚本的第1行都是正确的：

```
#!/bin/bash
#!/bin/sh
```

​	每条命令后面有一段以“#”符号起始的中文，“#”符号是注释符，它后面直到本行结束的所有内容是注释，脚本执行时是不执行注释的，“#”符号类似于C++和Java语言中的“//”符号，脚本注释可以是整行，也可以在某行的后面

​	命令（command）是Shell脚本的最基本元素，命令通常由命令名称、选项和参数三部分组成，三部分之间用空格键或Tab键分隔。

​	Linux系统有成千上万条命令，我们很难全部掌握这些命令，而且即便是经常使用的命令，我们往往也会忘记这些命令的选项和用法，此时可利用Linux系统提供的命令的手册页（manual page），我们可以用如下格式的命令打开某命令的手册页：

```
man [命令名称]
```

分号（;）可以用来隔开同一行内的多条命令，Shell会依次执行用分号隔开的多条命令。

### 执行Shell脚本

​	一般来说，当我们用文本编辑器创建一个Shell脚本文件时，该文件是没有可执行权限的，即x权限。因此，我们需要先赋给Shell脚本可执行权限，再去执行它。

```
chmod +x xxx.sh
```

# Linux文件系统和文本编辑器

## 用户和用户组管理

### 用户管理常用命令

​	值得注意的是，用户的角色是通过UID来识别的，用户的UID是全局唯一的。Linux用户可以分为三类。

*  root用户（也称为超级用户）：系统唯一，是真实的。该用户既可以登录系统，可以操作系统任何文件和命令，拥有最高权限。
* 虚拟用户：这类用户也被称为伪用户或假用户，与真实用户区分开来，这类用户不具有登录系统的能力，但却是系统运行不可缺少的用户，比如bin、daemon、adm、ftp、mail等；这类用户是系统自身拥有的，而非后来添加的，当然，我们也可以添加虚拟用户。



​	Linux用户管理的常用命令主要有：用户账号添加命令useradd或adduser、修改用户命令usermod、删除用户命令userdel及用户口令管理命令passwd等，下面将详细介绍这些命令。

**用户账号添加命令——useradd或adduser**

​	useradd和adduser是完全等价的两条命令，都是用于创建新的用户账号。我们以useradd为代表介绍它们的用法，命令格式如下：

```
useradd [option] [username]
```

​	其中，[option]为useradd命令选项，[username]是要创建的用户名。执行该命令后，将在系统中做以下一些事情：

* 在/etc/passwd文件中增添了一行记录。
* 在/home目录下创建新用户的主目录，并将/etc/skel目录中的文件复制到该目录中。



​	使用了该命令后，新建的用户暂时无法登录，因为还没有为该用户设置口令，需要再用passwd命令为其设置口令后，才能登录。用户的UID和GID是useradd自动选取的，它是将/etc/passwd文件中的UID加1，将etc/group文件中的GID加1。

​	使用useradd或adduser命令增加新用户时，系统将为用户创建一个与用户名相同的组，称为私有组，这一方法是为了能让新用户与其他用户隔离，确保安全性的措施。如果要改变私有组的名字，可以使用-g选项来完成。

​	通过“tail -l /etc/shadow”命令查看文件/etc/shadow，可以获得用户wang的密码，由于还没有为wang用户创建密码，可以看到wang后为“!!”，表示用户密码不可用，最后通过ls命令查看/home目录，可以看到为wang用户创建的主目录已经存在。

**修改用户账号——usermod**

​	usermod命令可用来修改用户账号的各种属性，包括用户主目录、私有组、登录Shell等内容，usermod的命令格式如下：

```
usermod [option] [username]
```

​	需要注意的是，最好不要使用usermod命令修改用户密码，因为如果用usermod命令，则显示在文件“/etc/shadow”中的密码是明密码，应该用passwd命令修改密码。

​	还需注意，usermod不允许改变已登录用户的用户账号名称，当用户修改UID时，也必须确认这个用户没有在电脑上执行任何程序。

**删除用户账号命令——userdel**

userdel命令非常简单，只有一个可选项-r，如果在userdel后加上-r选项，则在删除用户的同时也一并删除存储在/home目录下的该用户目录和文件。

![](https://pic.imgdb.cn/item/60ce97fe844ef46bb2d8aa36.jpg)

**用户口令管理命令——passwd**

​	当用户作为普通用户修改自己的密码时，首先会提示用户的原密码，然后会要求用户重新输入两次来验证用户新口令，如果口令一致，则新口令设置成功。而超级用户root为用户设定密码时，则不需要原密码。

```sh
passwd [option] [username]
```



![](https://pic.imgdb.cn/item/60ce9a56844ef46bb2ea1612.jpg)

### 用户组管理常用命令

**用户组添加命令——groupadd**

groupadd可指定用户组名称来建立新的用户组，需要时可从系统中取得新用户组值。其语法格式为：

```
groupadd [option] [groupname]
```

​	其中，[option]为groupadd命令选项，[groupname]是将要创建的用户组名，表2-4 为groupadd命令的选项及其意义。

![](https://pic.imgdb.cn/item/60ce9bb7844ef46bb2f4c2e8.jpg)

groupadd命令其实用起来非常简单，下面的例2-6 添加了一个GID为666 的用户组wangyq，可以在文件/etc/group的目录中查看到GID为666的用户组wangyq。

```
groupadd -g 666 sorie
```

如果调用groupadd命令时不设置GID号，如下面命令：

```
groupadd grp1
```

则在系统中增加一个新组group1，新组的组标识GID是在当前最大组标识的基础上加1。

**用户组修改命令——groupmod**

groupmod可指定用户组名称来修改新的用户组号或用户组名称，其语法格式为：

```
groupmod [option] [groupname]
```

其中，[option]为groupmod命令选项，[groupname]为用户组名，表2-5为groupmod命令选项及其意义。

![](https://pic.imgdb.cn/item/60cea387844ef46bb2309e6d.jpg)

**用户组删除命令——groupdel**

​	groupdel可指定用户组名称来删除已有的用户组，其语法格式为

```
groupdel [groupname]
```

​	该命令非常简单，但需注意的是，如果该用户组中包含某些用户，则必须先删除这些用户，然后才能删除该用户组。

## 文件和目录操作

### 文件操作常用命令

**ls**

![](https://pic.imgdb.cn/item/60cea401844ef46bb234168a.jpg)

**文件复制命令——cp**

![](https://pic.imgdb.cn/item/60cea427844ef46bb2352c8a.jpg)

**文件移动命令——mv**

![](https://pic.imgdb.cn/item/60cea44e844ef46bb2364cdc.jpg)

**删除文件命令——rm**

![](https://pic.imgdb.cn/item/60cea462844ef46bb236e76c.jpg)

### 目录操作常用命令

**创建目录命令——mkdir**

![](https://pic.imgdb.cn/item/60cea4de844ef46bb23a8aae.jpg)

**删除目录命令——rmdir**

​	rmdir命令可以删除一个或多个目录，在删除目录时，目录必须为空。rm命令可以同时删除多个目录，在删除某一目录时，必须拥有该目录的父目录的写和执行的权限。

![](https://pic.imgdb.cn/item/60cea50b844ef46bb23be2e8.jpg)

**目录切换命令——cd**

略

### 文件和目录权限管理

​	Linux系统中的每个文件和目录都有访问许可权限，用它来确定用户能以何种方式对文件和目录进行访问和操作。文件或目录的访问权限分为只读、只写和可执行三种。以文件为例，只读权限表示只允许读其内容，而禁止对其做任何的更改操作；可执行权限表示允许将该文件作为一个程序执行。文件被创建时，文件所有者自动拥有对该文件的读、写和可执行权限，以便于对文件的阅读和修改。用户也可根据需要把访问权限设置为任何组合。

​	有三种不同类型的用户可对文件或目录进行访问：文件所有者、同组用户、其他用户。文件所有者一般是文件的创建者，他可以允许同组用户访问文件，还可以将文件的访问权限赋予系统中的其他用户，从而使系统中每一位用户都能访问该所有者拥有的文件或目录。

​	每一文件或目录的访问权限都有三组，每组用三位表示，分别为文件属主的读、写和执行权限，与属主同组的用户的读、写和执行权限，以及系统中其他用户的读、写和执行权限。

**更改文件（目录）权限命令——chmod**

```
chmod [userType] [singal] [type] [filename]
```

![](https://pic.imgdb.cn/item/60cecbb3844ef46bb2590a0f.jpg)

注意：chmod命令的不同参数之间需要用逗号隔开。

​	那么什么是chmod的数字设定法呢？首先需要了解用数字表示属性的含义：0表示没有权限，1表示可执行权限，2表示可写权限，4表示可读权限，然后将其相加。所以，数字属性的格式应为3个从0到7的八进制数，其顺序是u，g，o。比如例2-22中的

![](https://pic.imgdb.cn/item/60cece11844ef46bb26d24a4.jpg)

**更改文件（目录）属主命令——chown**

​	利用chown命令可以改变文件或目录的属主。一般来说，这个指令只由系统管理者（root）使用，一般使用者没有权限改变别人的文件或目录属主，也没有权限将自己的文件属主更改为别人的，只有系统管理者（root）才有这样的权限。chown命令的一般形式为：

![](https://pic.imgdb.cn/item/60cecf7f844ef46bb2792d44.jpg)

**特殊权限命令——SUID与SGID**

​	除了上面提到的基本权限操作外，还有所谓的特殊权限存在。由于特殊权限会拥有一些“特权”，因而，用户若无特殊需要，不应该去打开这些权限，避免安全方面出现严重漏洞，甚至摧毁系统。但有时却需要没有被授权的用户完成某项任务，例如passwd程序，它允许用户改变口令，这就要求改变/etc/passwd文件的口令域。然而系统管理员决不允许普通用户拥有直接改变这个文件的权利，为了解决这个问题，SUID/SGID便应运而生，下面介绍了这两个特殊权限的说明。

* SUID：当一个设置了SUID位的可执行文件被执行时，该文件以所有者的身份运行，也就是说，无论谁来执行这个文件，它都拥有文件所有者的特权，可以任意使用该文件拥有者能使用的全部系统资源。如果所有者是root，那么执行人就有超级用户的特权了。
* SGID：当一个设置了SGID位的可执行文件被执行时，该文件将具有所属组的特权，任意存取整个组所能使用的系统资源；若一个目录设置了SGID，则所有被复制到这个目录下的文件，其所属的组都会被重设为和这个目录一样，除非在复制文件时加上-p选项，才能保留原来所属的群组设置。还可以使用符号方式来设置SUID/GUID。

### 查找文件命令——find

find命令是Linux系统查找文件的命令，find命令能帮助用户在使用、管理Linux的日常事务时方便地查找出用户所需要的文件。find命令的基本格式是：

```
find [path] [选项] [操作]
```

​	在上述find命令中，路径是find命令所查找的目录路径，例如，用“.”来表示当前目录，用“/”来表示系统根目录。选项用于指定查找条件，如：可以指定按照文件属主、更改时间、文件类型等条件来查找。

![](https://pic.imgdb.cn/item/60ced151844ef46bb289b403.jpg)

![](https://pic.imgdb.cn/item/60ced161844ef46bb28a3cec.jpg)

![](https://pic.imgdb.cn/item/60ced1e8844ef46bb28ea6b8.jpg)

​	find命令exec操作将对匹配的文件执行该参数所给出的Shell命令，下面的例2-27演示了exec操作的用法。

![](https://pic.imgdb.cn/item/60ced212844ef46bb290060f.jpg)

​	ok操作和exec的作用相同，只不过以一种更安全的模式来执行该参数所给出的Shell命令，在执行每一个命令之前，都会给出提示，让用户来确定是否执行。在执行一些危险操作时，建议使用ok操作，比如：下面的例2-28试图删除/var/log目录下更改时间距今3天内的所有文件，由于删除文件的操作是不可以恢复的，因此，find命令使用ok操作在删除文件之前给出提示，等待用户确定后再执行删除操作。

![](https://pic.imgdb.cn/item/60ced237844ef46bb29142ce.jpg)

## 文本编辑器

​	略

## 上机建议

2.使用文件操作命令创建一个文件，然后使用文件复制、移动和删除等命令对该文件进行操作。

3.创建一个目录，然后在该目录下再创建一个文件，并对该文件进行删除操作。

4.新建一个用户组group1，并新建一个系统组group2。

（1）更改组group2的GID为103，更改组名为grouptest。

（2）删除组grouptest。

5.新建用户user1，指定UID为777，目录为/home/user1，初始组为group1，有效组为root，指定shell为/bin/bash。

（1）新建一个系统用户user2。

（2）查看用户user1的组群，切换到user1，在主目录下新建文件test1，切换有效组为root，再新建文件test2。

（3）修改用户user1的个人说明为This is a test（提示加-c选项）。

（4）修改用户密码过期时间为2010-09-01。

（5）更改用户user1的密码为111111，加锁用户user1并查看/etc/shadow，用户user1通过ssh登录127.0.0.1。

（6）更改用户主目录/home/user1为/home/user11。

（7）列出用户user1的UID、GID等。

（8）增加用户user3、user4，增加组testgroup，给组testgroup设定密码，将组testgroup管理权授予user1，并同时将root、user1、user3加入到testgroup，检查结果，切换到user1，将user4加入到testgroup组。

（9）使用passwd将user1用户密码冻结，用passwd查看user1相关信息，最后用passwd将用户user1解冻。

（10）切换user1用户，用su加命令行