---
title: 图解HTTP学习笔记
date: 2020-08-01 00:01:38
tags: [图解HTTP, HTTP]
---

# 第1章 了解Web及网络基础

## 1.1 使用HTTP协议访问Web

​	输入url时，Web页面如何呈现的呢？

![](https://pic.imgdb.cn/item/5f2440e314195aa594bd1828.jpg)

​	浏览器根据地址栏中的url，从服务器端获取文件资源等信息，从而展示出Web页面。

​	Web使用一种名为HTTP(HyperText Transfer Protocol, 超文本传输协议)。

## 1.2 HTTP的诞生

### 1.2.1  为知识共享而规划Web

​	1989年3月。

​	CERN(欧洲核子研究组织)Tim BernerLee。

​	最初设想：借助多文档之间相互关联形成超文本(HyperText)，连成可相互参阅的WWW(World Wide Web, 万维网)。

​	现已提出3项WWW构建技术：

* SGML(Standard Generalized Markup Language, 标准通用标记语言)作为页面文本标记语言的HTML；
* 作为文档传输协议的HTTP；
* 指定文档地址所在的URL(Uniform Resource Locator, 统一资源定位符)。

### 1.2.2  Web成长时代

​	1990年11月。

​	CERN, 第一台Web服务器和Web浏览器。



​	1992年9月，日本第一个网站主页上线。



### 1.2.3  驻足不前的HTTP

#### HTTP/0.9

​	1990年问世，但是没有作为正式标准被建立，所以是0.9。

#### HTTP/1.0

​	1996年6月，1.0作为正式标准公布，记载于RFC1945。

​	http://www.ietf.org/rfc/rfc1945.txt

#### HTTP/1.1

​	1997年1月，公布HTTP/1.1。

​	当初的标准是RFC2068,之后发布的修订版本RFC2616是当前最新版本。

​	http://www.ietf.org/rfc/rfc2616.txt



​	新一代的HTTP/2.0正在制定中。

## 1.3 网络基础 TCP/IP

​	通常使用的网络是在TCP/IP协议族的基础上运作的。HTTP是内部的一个子集。

### 1.3.1 TCP/IP协议族

![](https://pic.imgdb.cn/item/5f24443c14195aa594be1c06.jpg)

​	把互联网相关联的协议集合起来总称为TCP/IP。

### 1.3.2 TCP/IP的分层协议

​	应用层、传输层、网络层和数据链路层。

#### 应用层

​	决定向用户提供应用服务时的通信的活动。

​	比如FTP(File Transfer Protocol, 文本传输协议)和DNS(Domain Name System, 域名系统)服务就是其中两类。

​	HTTP协议也处于该层。

#### 传输层

​	对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。

​	TCP（Transmission Control Portocol, 传输控制协议)

​	UDP(User Data protocol, 用户数据报协议)

#### 网络层（又名网络互连层）

​	用于处理在网络上流动的数据包。数据包是网络传输的最小数据单位。该层规定了通过怎样的路径（传输路线）到达对方计算机，并把数据包传给对方。

#### 链路层（又名数据链路层，网络接口层）

​	用于处理连接网络的硬件部分。

​	包括操作系统、硬件设备驱动、NIC（网卡)，以及光纤等物理课件部分。

### 1.3.3 TCP/IP 通信传输流

![](https://pic.imgdb.cn/item/5f256ab114195aa59428ad2b.jpg)



​	TCP/IP协议族进行网络通信时，会通过分层顺序与对方进行通信。

​	以HTTP为例：

![](https://pic.imgdb.cn/item/5f256c1d14195aa594293865.jpg)



​		把数据信息包装起来的做法称为封装。

## 1.4 与HTTP关系密切的协议：IP、TCP和DNS

### 1.4.1 负责传输的IP协议

​	IP(Internet Protocol)网际协议位于网络层。

​	几乎所有使用网络的系统都会用到IP协议。

​	作用是把各种数据包传送给对方。

​	要保证确实传送到对方那里，需要满足各类条件。其中最重要的两个条件是IP地址和MAC地址。

​	IP地址指明了节点所分配到的地址，MAC地址是指网卡所属的固定地址。

#### 使用ARP协议凭借MAC地址进行通信

​	ARP是一种用以解析地址的协议，根据通信方的IP地址就可以反查出对应的MAC地址。

#### 没有人能过全面掌握互联网中的传输状况

​	路由选择（routing)。

![](https://pic.imgdb.cn/item/5f25746514195aa5942cb550.jpg)



### 1.4.2 确保可靠性的TCP协议

​	TCP位于传输层，提供可靠的字节流服务。

​	字节流服务是指，为了方便传输，将大块数据分割成报文段(segment)为单位的数据包进行管理。

​	可靠性传输服务是指，能够把数据准确可靠的传给对方。

#### 确保数据能到达目标

​	采用三次握手协议(three-way handshaking)策略。

​	如果出现莫名中断，会在以相同的顺序发送相同的数据包。

![](https://pic.imgdb.cn/item/5f25755514195aa5942d4138.jpg)



## 1.5 负责域名解析的DNS服务

​	DNS(Domain Name System)是应用层协议。提供域名到IP地址之间的解析服务。

![](https://pic.imgdb.cn/item/5f2577d014195aa5942e4442.jpg)



## 1.6 各种协议与HTTP协议的关系

![](https://pic.imgdb.cn/item/5f25781514195aa5942e5ed8.jpg)

## 1.7 URI和URL

​	URI：统一资源标识符

​	URL(Uniform Resource Locator): 统一资源定位符



### 1.7.1 统一资源标识符

#### Uniform

​	规定统一的格式可以方便处理多种不同类型的资源。加入新增的协议方案也更加容易。比如http:， ftp:

#### Resource

​	资源：可标识的任何东西

#### Identifier

​	标识符。



​	URI用字符串标识某一互联网资源，而URL标识资源的地点。URL是URI的子集。

### 1.7.2 URI格式

![](https://pic.imgdb.cn/item/5f2579db14195aa5942f0669.jpg)

# 第2章 简单的HTTP协议

​	主要讲解HTTP/1.1版本。

## 2.1 HTTP协议用于客户端和服务端之间的通信

​	HTTP协议用于客户端和服务端之间的通信。

​	![](https://pic.imgdb.cn/item/5f26ddb714195aa594a213e2.jpg)



## 2.2 通过请求和响应的交换达成通信

​	HTTP规定，请求从客户端发出，最后服务器端响应请求并返回。

​	![](https://pic.imgdb.cn/item/5f26de0314195aa594a22a73.jpg)



​	请求报文是由请求方法、请求URI、协议版本、可选的请求首部字段和内容实体组成。

​	![](https://pic.imgdb.cn/item/5f26de9014195aa594a25898.jpg)

​	

​	响应报文基本上由协议版本、状态码（表示请求成功或失败的数字代码）、用以解释状态码的原因短语、可选的响应首部字段以及实体主体构成。

## 2.3 HTTP是不保存状态的协议

​	HTTP是不保存状态的协议。但是引入了Cookie技术，有了Cookie再用HTTP协议通信，就可以管理状态了。

## 2.4 请求URI定位资源

​	HTTP协议使用URI定位互联网上的资源。

​	![](https://pic.imgdb.cn/item/5f26df5414195aa594a28d3a.jpg)



​	如果不是访问特定资源而是对服务器本身发起的请求，可以用一个*来代替请求URI

![](https://pic.imgdb.cn/item/5f26df8714195aa594a29945.jpg)

## 2.5 告知服务器意图的HTTP方法

* GET: 获取资源

* POST: 传输实体主体

* PUT:传输文件

* HEAD:获得报文首部

  * 用于确认URI的有效性以及资源更新的日期时间等

* DELETE：删除文件

* OPTIONS:询问支持的方法

  ![](https://pic.imgdb.cn/item/5f26e04014195aa594a2cd50.jpg)

* TRACE:追踪路径（不常用，而且容易引发XST攻击 跨站追踪）

* CONNECT: 要求用隧道协议连接代理

  ![](https://pic.imgdb.cn/item/5f26e09614195aa594a2e688.jpg)



## 2.6 使用方法下达命令

![](https://pic.imgdb.cn/item/5f26e0bd14195aa594a2f301.jpg)

## 2.7 持久连接节省通信量

​	HTTP初始版本中，每进行一次HTTP通信就要断开一次TCP连接。

​	以前通信都是容量很小的文件传输，所以没问题，但是现在有比较多的图片就有问题。

### 2.7.1 持久连接

​	HTTP/1.1和一部分的HTTP/1.0想出了持久连接(HTTP Persistent Connection, 也称为 HTTP keep-alive 或 HTTP connection reuse)的方法。

​	特点是：只要任意一段没有明确提出断开连接，则保持TCP连接状态。

​	在HTTP/1.1中，所有的连接都是持久连接。

### 2.7.2 管线化

​	持久连接使得多数请求与以管线化(pipelining)方式发送称为可能。

​	管线化技术出现后，不用等待响应亦可直接发送下一个请求。

​	管线化技术比持久连接还要快。

## 2.8 使用Cookie的状态管理

​	无状态协议可以减少服务器CPU以及内存资源的消耗。

​	为了解决矛盾，引入Cookie信息。

​	Cookkie信息从服务端发送的响应报文中一个叫做Set-Cookie的字段首部信息，通知客户端保存Cookie。

​	下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入Cookie值后发送出去。



![](https://pic.imgdb.cn/item/5f26e3b814195aa594a46a3c.jpg)

![](https://pic.imgdb.cn/item/5f26e3d814195aa594a47342.jpg)

# 第3章 HTTP的报文内的HTTP信息

## 3.1  HTTP报文

​	HTTP协议交互的信息被称为HTTP报文。

​	请求端的报文叫做请求报文。

​	响应端的叫做响应报文。

​	报文本身是多行(用CR+LF作换行符)数据构成的字符串文本。

​	![](https://pic.imgdb.cn/item/5f26e69d14195aa594a53126.jpg)

## 3.2 请求报文及响应报文的结构

![](https://pic.imgdb.cn/item/5f26e74414195aa594a55e97.jpg)

![](https://pic.imgdb.cn/item/5f26e75814195aa594a565d5.jpg)

#### 请求行

​	包含用于请求的方法，请求的URI和HTTP版本。

#### 状态行

​	 包含表明响应结果的状态码，原因短语和HTTP版本。

#### 首部字段

​	包含表示请求和响应的各种条件和属性的各类首部。

​	一般有4种首部，分别是：通用首部、请求首部、响应首部和实体首部

#### 其他

​	可能包含HTTP的RFC里未定义的首部(Cookie等)

## 3.3  编码提升传输速率

​	通过再传输时编码，能有效地处理大量的访问请求。但是编码操作会消耗更多的CPU等资源。

### 3.3.1 报文主题和实体主体的差异

 * 报文

   是HTTP通信的基本单位，以8位组字节流(octet sequence,其中octet为8个比特)。

* 实体

  作为请求或相应的有效负荷数据被传输，其内容由实体首部和实体主体组成。

### 3.3.2 压缩传输的内容编码

​	HTTP协议中有一种被称为内容编码的功能。

​	![](https://pic.imgdb.cn/item/5f26e97814195aa594a5f3d9.jpg)

### 3.3.3 分割发送的分块传输编码

​	通信过程中，实体资源没全部传输完成之前，浏览器无法显示请求页面。传输大容量数据，通过把数据分割成多块，能够让浏览器逐步显示页面。

​	这个功能称为分块传输编码(Chunked Transfer Coding)。

​	![](https://pic.imgdb.cn/item/5f26ea0114195aa594a61b6c.jpg)



​	分块传输编码会将实体主题分成多个部分。每一块都会用十六进制来标记块的大小，而实体主题的最后一块会使用"0(CR+LF)"来标记。

​	接收的客户端负责解码，恢复到编码前的实体主题。

​	HTTP/1.1中存在一种被称为传输编码 （Transfer Coding）的机制，它可以在通信时按某种编码传输，但只定义作用于分块编码中。

## 3.4 发送多种数据的多部分对象集合

​	HTTP协议也采纳了多部分对象集合，发送的一份报文主题中可含有多类型的实体。通常是在图片或文本文件等上传时使用。

​	多部分对象集合包含的对象如下。

​	![](https://pic.imgdb.cn/item/5f26e54e14195aa594a4dadb.jpg)

​	在使用多部分对象集合时，需要在首部字段里加上Content-type。

​	使用boundary字符串划分多部分对象实体集合致命各类实体。在boundary字符串的各个实体的是起航之前加入"--"标记。

​	而在多部分集合对应的字符串最后插入"--"标记作为结束。

## 	3.5 获取部分内容的范围请求

​	下载尺寸较大的内容遇到网络中断的情况，需要一种可恢复的机制。需要指定下载的实体范围，指定范围发送的请求叫做范围请求（Range Request）。

​	对一份10000字节的内容，使用范围请求可以只请求5001~10000字节内的资源。

​	![](https://pic.imgdb.cn/item/5f2812e614195aa594fb899c.jpg)

![image-20200803214248537](C:\Users\81929\AppData\Roaming\Typora\typora-user-images\image-20200803214248537.png)

​	针对范围请求，响应会返回状态码为206 Partial Content的响应报文。

​	多重范围的范围请求，响应会在首部字段Content-Type标明multipart/byteranges后返回响应报文。

​	如果无法响应范围请求，就会返回200 OK和完整的实体内容。

## 3.6 内容协商返回最合适的内容

​	访问相同的URI，显示对应的中文版或英文版的Web页面。这样的机制称为内容协商(Content Neotiation)。

​	![](https://pic.imgdb.cn/item/5f28197b14195aa594fdba5b.jpg)



​	包含在请求报文中的某些首部字段就是判断基准。

![](https://pic.imgdb.cn/item/5f2819a814195aa594fdc655.jpg)

![](https://pic.imgdb.cn/item/5f2819b514195aa594fdcb26.jpg)

​	内容协商技术有以下三种类型：

* 服务器驱动协商(Server-driven Negotiation)

  由服务器端进行内容协商，以请求的首部字段为参考，在服务器端自动处理，并不一定能筛选出最优内容。

* 客户端驱动协商(Agent-driven Negotiation)

  由客户端进行内容协商的方式。用户从浏览器显示的可选项列表中手动选择。比如按OS类型或浏览器类型自行切换成PC版页面或手机页面。

* 透明协商(Transparent Negotiation)

  以上两种结合体。

# 第4章 返回结果的HTTP状态码

## 4.1 状态码告知从服务器端返回的请求结果

![](https://pic.imgdb.cn/item/5f28363714195aa594063b8c.jpg)

![](https://pic.imgdb.cn/item/5f28364714195aa59406412b.jpg)

## 4.2 2XX成功

### 4.2.1 200 OK

​	正常处理

### 4.2.2 204 No Content

​	成功处理，返回的响应报文不含实体的主体部分。

### 4.2.3 206 Partical Content

​	成功执行了范围请求部分的GET请求。响应报文包含Content-Range指定范围的实体内容。

## 4.3.3 XX重定向

### 4.3.1 301 Moved Permanently

​	永久性重定向，表示请求资源被分配了新的URI。以后应使用资源现在所指的URI。

![](https://pic.imgdb.cn/item/5f28371814195aa594067776.jpg)

### 4.3.2 302 Found

​	临时性重定向。表示请求资源被分配了新的URI。希望用户这次用新的URI。

### 4.3.3 303 See Other

​	表示由于请求对应的资源存在着另一个URI，赢使用GET方法定向获取请求的资源。

​	和302相同，只是明确表示应当采取GET方法获取资源。

![](https://pic.imgdb.cn/item/5f2837f214195aa59406ad3b.jpg)

### 4.3.4 304 Not Modified

​	表示客户端发送附带条件的请求时，服务器端允许请求访问资源，但因发生请求为满足条件的情况后，直接返回304（服务器资源未改变，可直接使用客户端未过期的缓存）。304其实和重定向没有关系。

![](https://pic.imgdb.cn/item/5f28386a14195aa59406ca87.jpg)

### 4.3.5 307 Temporary Redirect

​	临时重定向。与302相同含义。尽管302禁止POST变换成GET，但实际使用时大家并不遵守。

​	307会遵守浏览器标准，不会从POST变成GET。但是处理响应时的行为，各个浏览器可能不一样。

## 4.4 4XX客户端错误

### 4.4.1 400 Bad Request

​	请求报文存在语法错误。

### 4.4.2 401 Unauthorized

​	未通过HTTP认证。

### 4.4.3 403 Forbidden

​	不允许这个资源。

### 4.4.4 404 Not Found

​	无法找到请求的资源

## 4.5 5XX服务器错误

### 4.5.1 500 Internal Server Error

​	请求发生了错误，可能是Web应用存在bug或者临时故障

### 4.5.2 503 Service Unavailable

​	服务器暂时处于超复杂或者正在进行停机维护，无法处理其你去。

![](https://pic.imgdb.cn/item/5f2839f114195aa594072882.jpg)

![](https://pic.imgdb.cn/item/5f2839fb14195aa594072bf8.jpg)



> **状态码和状况不一致**
>
> 不少返回的状态码响应都是错误的，用户可能察觉不到这一点。比如程序内部发生错误，状态码依然返回200 OK， 这种情况经常遇到。

# 第5章 

​	一台Web服务器可以搭建多个独立域名的Web网站。

## 5.1 用单台虚拟主机实现多个域名。

​	![](https://pic.imgdb.cn/item/5f2ebbcb14195aa5947dd628.jpg)

​	在相同IP地址下，由于虚拟主机可以寄存多个不同主机名和域名的Web网站，因此在发送HTTP请求时，必须在Host首部内完整指定主机名或域名的URI。

## 5.2 通信数据转发程序：代理、网关、隧道。

#### 代理

​	代理是一种具有转发功能的应用程序。扮演在服务器和客户端“中间人”的角色。

#### 网关

​	网关是转发其他服务器通信数据的服务器，接收从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理。

#### 隧道

​	在相隔甚远的客户端和服务器之间进行中转，并保持双方通信连接的应用程序。

### 5.2.1 代理

​	![](https://pic.imgdb.cn/item/5f2ebe4714195aa5947f0dad.jpg)

​	代理不改变请求URI，会直接发送给前方持有资源的服务器。

​	持有资源实体的服务器被称为源服务器。

![](https://pic.imgdb.cn/item/5f2ebea314195aa5947f2b60.jpg)

​	使用代理服务器的理由有：

* 利用缓存技术减少网络带宽的流量
* 组织针对特定网站的访问控制，以获取日志为主要目的等。



​	代理有多种使用方法，按两种基准分类。一种是是否使用缓存，另一种是是否会修改报文。



#### 缓存代理

​	代理转发响应时，缓存代理(Caching Proxy)会预先将资源的副本（缓存）宝成怒在代理服务器上。

#### 透明代理

​	转发请求或响应时，不对报文做任何佳通的代理类型被称为透明代理（Transparent Proxy）。

## 5.2.2 网关

​	![](https://pic.imgdb.cn/item/5f2ebf7d14195aa5947f7708.jpg)

​	工作机制和代理十分相似。而能使通信线路上的服务器提供非HTTP协议服务。

​	可以提高通信的安全性。

### 5.2.3 隧道

​	可以按要求建立一条与其他服务器的通信线路，使用SSL等加密手段进行通信。

​	隧道本身不会去解析HTTP请求。

![](https://pic.imgdb.cn/item/5f2ebff914195aa5947fa0fe.jpg)

## 5.3 保存资源的缓存

​	缓存是指代理服务器或者哭护短本地磁盘内保存的资源副本，可减少对源服务器的访问，节省流量和时间。

​	缓存服务器是代理服务器的一种，并归类在缓存代理类型中。

![](https://pic.imgdb.cn/item/5f2ec0c214195aa5947fe5a5.jpg)

### 5.3.1 缓存的有效期限

​	即使存在缓存，也会因为客户端的要求、缓存的有效期等因素，向源服务器确认资源的有效性。如果判断缓存失败，就会向源服务器上获取“新”资源。

### 5.3.2 客户端的缓存

​	缓存不仅可以缓存于缓存服务器内，还可以存在客户端浏览器中。浏览器缓存如果有效，就不必再想服务器请求相同资源了。



> **在HTTP出现之前的协议**
>
> **FTP**
>
> ​	传输文件时使用的协议。仍然广泛使用。
>
> **NNTP**
>
> ​	用于NetNews电子会议室内传送消息的协议，不怎么使用了
>
> **Archie**
>
> ​	搜索anonymous FTP公开的文献信息的协议，不常使用了。
>
> **WAIS**
>
> ​	以关键词检索多个数据库使用的协议，被HTTP替代，不常使用。
>
> **Gopher**
>
> ​	查找与互联网连接的计算机内信息的协议，被HTTP替代，不怎么使用。

# 第6章 HTTP首部

## 6.1HTTP报文首部

![](https://pic.imgdb.cn/item/5f30198014195aa594edaa03.jpg)



​	HTTP请求和响应报文中必定包含HTTP首部。

### 	HTTP请求报文

​	请求报文首部由方法、URI、HTTP版本、HTTP首部字段等部分构成。

![首部](https://pic.imgdb.cn/item/5f3019fa14195aa594edc6e9.jpg)

### HTTP响应报文

​	响应报文首部由HTTP版本、状态码（数字和原因短语）、HTTP首部字段3部分构成。



## 6.2 HTTP首部字段

### 6.2.1 HTTP首部字段传递重要信息

​	是为了给浏览器和服务器提供报文主题大小、所使用的语言、认证信息等内容。

### 6.2.2 HTTP首部字段结构

​	用冒号":"分隔。

​	字段值对应单个HTTP首部字段可以有多个值。

![](https://pic.imgdb.cn/item/5f301b5214195aa594ee1bd2.jpg)

#### 实体首部字段(Entity Header Fields)

​	针对请求报文和响应报文的实体部分使用的首部。补充了资源内容更新时间等于实体有关的信息。

### 6.2.4 HTTP/1.1首部字段一览

![](https://pic.imgdb.cn/item/5f301c3714195aa594ee5182.jpg)

![](https://pic.imgdb.cn/item/5f301be714195aa594ee3e1e.jpg)

![](https://pic.imgdb.cn/item/5f301c5a14195aa594ee6681.jpg)

![](https://pic.imgdb.cn/item/5f301c9e14195aa594ee95bf.jpg)

### 6.2.5 非HTTP/1.1首部字段

​	Cookie、Set-Cookie和Content-Disposition等在其他RFC中定义的首部字段使用频率也很高。

​	这些非正式的字段统一归纳在RFC4229 HTTP Header Field Registrations中。

### 6.2.6 End-toEnd首部和Hop-by-hop首部

​	首部字段将定义成缓存代理和非缓存代理的行为，分为两种类型

#### 端到端首部(End-toEnd Heder)

​	请求会转发给请求/向的最终接收目标，且必须保存在缓存生成的响应中，规定它必须被转发。

#### 逐跳首部(Hop-by-hop Header)

​	只对单词转发有效，会因通过缓存或代理而不再转发。HTTP/1.1和之后版本中，要使用hop-by-hop首部，需提供Connection首部字段。

除了一下8个，其他都是端到端首部

![](https://pic.imgdb.cn/item/5f301dc914195aa594eef1d2.jpg)

## 6.3 HTTP/1.1 通用首部字段

​	指请求报文和响应报文双方都会使用的首部。

### 6.3.1  Cache-Control

​	![](https://pic.imgdb.cn/item/5f314c9f14195aa594400650.jpg)

​	参数可选，多个指令之间用","分割

![](https://pic.imgdb.cn/item/5f314cf814195aa5944029da.jpg)

![](https://pic.imgdb.cn/item/5f314d0314195aa594402ded.jpg)

![](https://pic.imgdb.cn/item/5f314d0f14195aa594403333.jpg)

#### public指令

```
Cache-Control：public
```

​	明确表明其他用户也可利用缓存。

#### private指令

​	与public相反，只对特定用户提供资源缓存服务。

#### no-cache指令

​	目的是为了防止从缓存中返回过期的资源。

​	表示客户端将不会接收缓存过的响应。

​	在服务器返回的响应中，如果Cache-Control对no-cache字段名具体指定参数值。那么客户端接收到这个被指定参数的首部字段对应的响应报文之后，就不能使用缓存。

​	换言之，只能在无参数值的首部字段可以使用缓存。

#### no-store指令

​	no-cache代表不缓存过期资源。no-store才是真正的不进行缓存。

#### s-maxage指令

​	和max-age指令功能相同，不同点是s-maxage只适用于供多维用户使用的公共缓存服务器。也就是说，向同一用户重复返回响应的服务器，这个指令没有任何作用。

​	另外使用该指令后，则直接忽略Expires首部字段以及max-age指令的处理。

​	单位：秒

#### max-age指令

​	包含该指令时，判定缓存资源的缓存时间数值比指定时间数值更小，那么客户端就接收缓存的资源。另外，当指定max-age为0，缓存服务器通常需要将请求转发给源服务器。

​	响应包含max-age指令时，缓存服务器不对资源有效性再做确认，而max-age数值代表资源保存为缓存的最长时间。



​	如果同时存在Expires指令，在HTTP/1.1中，以max-age优先，HTTP/1.0则相反。

​	单位：秒

#### min-fresh 指令

​	要求缓存服务器返回至少还未过指令时间的缓存资源。	

​	单位：秒

#### max-stale指令

​	可指示缓存，即使过期也照常接收。

​	没有指定具体参数值，无论多久，客户端都会接收响应；指定了值，即使过期，只要仍处于max-stale指定时间内，仍旧会被客户端接收	

​	单位：秒

#### only-if-cached指令

​	表示客户端仅在缓存服务器本地缓存目标资源的情况下，才会要求其返回。否则返回504 Gateway Timeout

#### must-revalidate指令

​	代理会向源服务器再次验证即将返回的响应缓存目前是否仍然有效。如果代理无法连通源服务器再次获取有效资源的话，缓存必须给客户端一条504状态码。

​	使用它会忽略max-stale指令

#### proxy-revaliate指令

​	要求所有缓存服务器在接收到客户端带有该指令的请求返回响应前，必须再次验证缓存的有效性。

#### no-transform指令

​	规定无论是请求还是在响应中，缓存都不能改变实体主体的媒体类型。

#### 

#### cache-extension token

​	通过cache-extension token。可以扩展Cache-Control首部字段内的指令。

### 6.3.2 Connection

​	有如下两个作用

* 控制代理不再转发的首部字段
* 管理持久连接

#### 控制代理不再转发的首部字段

![](https://pic.imgdb.cn/item/5f31529c14195aa594427f9e.jpg)



#### 管理持久连接

​	![](https://pic.imgdb.cn/item/5f3152c014195aa594428c72.jpg)

​	HTTP/1.1默认都是持久连接。如果客户端向断开连接，则指定该字段为Close。

​	之前的版本都是非持久连接，如果旧版本想要维持持续连接，则需要指定字段为Keep-Alive。

### 6.3.3 Date

​	Date表明创建HTTP报文的日期和时间。

![](https://pic.imgdb.cn/item/5f31548014195aa594436361.jpg)

### 

### 	6.3.4 Pragma

​	是之前版本的遗留字段。

​	只能指定为no-cache,只用于客户端发送的请求中，要求所有中间服务器不返回缓存的资源。

​	如果中间服务器都以HTTP/1.1为基准，则直接采用Cache-Control：no-cache是最理想的。但是不现实，因此请求会同时包含下面两个首部字段。

![](https://pic.imgdb.cn/item/5f31551314195aa594439b4a.jpg)

### 6.3.5 Trailer

​	会实现说明报文主题后记录了哪些首部字段。该字段可用于1.1版本分块传输编码时。

### 6.3.6 Trasnfer-Encoding

​	规定了传输报文主体时采用的编码方式。

### 6.3.7  Upgrade

​	用于检测HTTP协议与其他协议是否可使用更高的版本进行通信，可以用来指定一个完全不同的通信协议。

​	Upgrade对象仅限于客户端和邻接服务器之间，使用时，需要额外指定Connection:Upgrade。

​	对于附有该字段的请求，可用101 Switching Protocols状态码作为响应返回。

### 6.3.8 Via

​	该字段是为了追踪客户端与服务器之间的请求与响应报文的传输路径。

![](https://pic.imgdb.cn/item/5f31589814195aa59444fbf6.jpg)

​	不仅用于追踪报文的转发，还可以避免请求回环的发生，所以必须在经过代理时附加该首部字段内容。

​	经常和TRACE方法一起使用。

### 6.3.9 Warning

​	是从1.0的响应首部(Retry-After)演变过来的，通常会告知一些与缓存相关问题的警告。

​	HTTP/1.1定义了7种警告。具有扩展性，以后可能添加新的警告嘛。

![](https://pic.imgdb.cn/item/5f31593e14195aa594453fd4.jpg)



## 6.4 请求头部字段

### 6.4.1 Accept

​	通知用户代理能够处理的媒体类型及媒体类型的相对优先级。可使用type/subtype这种形式，一次指定多种媒体类型。

![](https://pic.imgdb.cn/item/5f329eff14195aa594b8d5b2.jpg)



​	若想要给显示的媒体类型增加优先级，则使用q=来表示权重值，用分号进行分隔。范围是0~1，可精确到小数点后3位，默认为1.

​	![](https://pic.imgdb.cn/item/5f329f6f14195aa594b8fa30.jpg)

### 6.4.2 Accept-Charset

​	通知服务器用户代理支持的字符集以及字符集的相对优先顺序。类似于Accept字段，可以用q来指定相对优先级。	

​	应用于内容协商机制的服务器驱动协商。

### 6.4.3 Accept-Encoding

​	用来告知服务器用户代理支持的内容编码以及内容编码的优先级顺序。可一次指定多种内容编码。

* gzip: Lempel-Ziv(LZ777)算法压缩即32位循环冗余校验(CRC)
* compress:Lempel-Ziv-Welch(LZW)算法压缩
* deflate: 组合使用zlib格式及deflate压缩算法生成的编码格式
* identity：不执行压缩或不会变化的默认编码格式



​	采用q值来表示相对优先级。可以使用*号指定任意的编码格式。



### 6.4.4  Accept-Language

​	告知服务器用户代理能够处理的自然语言集，用q表示相对优先级。

### 6.4.5 Authorization

​	告知服务器认证信息。

### 6.4.6 Expect

​	告知服务器，期望出现的某种特定行为。如果服务器无法理解客户端期望而作出回应发生错误时，会返回状态码417 Expectation Failed；

​	规范只定义了100-continue(状态码 100 Continue的意思)。

### 6.4.7 From

​	告知用户代理的用户电子邮件地址。但可能因为代理不同，将电子邮件地址记录在User-Agent首部字段内。

### 6.4.8 Host

​	告知服务器，请求资源所处的互联网主机名和端口号。是规范内唯一一个必须被包含在请求内的首部字段。

​	若服务器未设定主机名，直接发送一个空值即可。

### 6.4.9 If-Match

​	类似于If-xxx都称为条件请求。

![](https://pic.imgdb.cn/item/5f32a44114195aa594ba967d.jpg)

### 6.4.10 If-Modified-Since

![](https://pic.imgdb.cn/item/5f32a48914195aa594bac743.jpg)

​	通过确认Last-Modified首部字段来确定。

### 6.4.11 If-None-Match

![](https://pic.imgdb.cn/item/5f32a4c914195aa594bade4d.jpg)



​	在Get或Head方法中使用它可获取最新的资源。

### 6.4.12 If-Range

![](https://pic.imgdb.cn/item/5f32a50c14195aa594baf54c.jpg)

### 6.4.13 If-Unmodified-Since

​	与If-Modified-Since相反。

### 6.4.14 Max-Forwards

![](https://pic.imgdb.cn/item/5f32a65114195aa594bb54e2.jpg)

​	通过TRACE方法和OPTIONS方法，该首部以10进制整数指定可经过服务器的最大数目。当为0时，不再进行转发，直接响应请求。

### 6.4.15 Proxy-Authorization

​	与HTTP访问认证类似，只是发生在客户端和代理之间。

### 6.4.16 Range

​	告知服务器资源的指定范围。

### 6.4.17 Referer

​	告知服务器请求原始资源的URI

### 6.4.18 TE

​	告知服务器客户端处理响应的传输编码方式和相对优先级，和Accept-Encoding很像，但是用于传输编码。

​	还可以伴随trailer字段的分块传输编码。

​	TE:trailers

### 6.4.19 User-Agent

![](https://pic.imgdb.cn/item/5f32aad114195aa594bca1a2.jpg)

## 6.5 响应首部字段

### 6.5.1 Accept-Ranges

![](https://pic.imgdb.cn/item/5f37fd1b14195aa594148228.jpg)

### 6.5.2 Age

​	单位秒，至缓存后的响应再次大气认证到认证完成的时间值。

### 6.5.3 ETag

​	告知客户端实体标志。

![](https://pic.imgdb.cn/item/5f37fd6214195aa594149920.jpg)

### 6.5.4 Location

​	可以将响应接收方引导只某个域请求URI位置不同的资源。

​	会配合3xx：重定向URI。

### 6.5.5 Proxy-Authenticate

​	会把代理服务器所要求的认证信息发送给客户端。

### 6.5.6 Retry-After

​	告知客户端应该多久之后再次发送请求，配合503或3xx响应一起使用。

### 6.5.7 Server

​	告知客户端当前服务器上安装的HTTP服务器应用程序信息。

### 6.5.8 Vary

![](https://pic.imgdb.cn/item/5f37ffcf14195aa594154eeb.jpg)

## 6.6 实体首部字段

### 6.6.1 Allow

​	告诉URI支持的所有HTTP方法。

### 6.6.2 Content-Encoding

​	告诉客户端实体主题部分选用的内容编码方式。

### 6.6.3 Content-Language

​	标记实体主体使用的自然语言。

### 6.6.4 Content-Length

​	表明实体主题部分大小，单位字节。

### 6.6.5 Content-Location

​	给出与报文主题部分相对于的URI。和首部字段Location不同，它表示的是报文主题返回资源对应的URI。

### 6.6.6 Content-MD5

​	目的在于检查报文主题在传输过程中是否保持完整，以及确认传输到达。

​	对内容上的偶发性改变无法查证，也不乏检测出恶意篡改。

### 6.6.7 Content-Range

​	针对范围请求，告知返回的实体哪个部分符合范围请求。单位字节。

​	![](https://pic.imgdb.cn/item/5f39383e14195aa5945df427.jpg)

### 6.6.8 Content-Type	

​	说明实体主体内对象的媒体类型。

### 6.6.9 Expires

​	告知资源失效的日期。不希望缓存服务器对资源缓存时，最好写入与首部字段Date相同的时间值。

​	会更优先处理max-age。

### 6.6.10 Last-Modified

​	资源最终修改时间。

## 6.7 为Cookie服务的首部字段

**由网景公司颁布的规格标准**

	网景通信公司设计并开发了Cookie。



### 6.7.1 Set-Cookie

![](https://pic.imgdb.cn/item/5f38fb8b14195aa5944d7ac5.jpg)

#### expires属性

	指定浏览器可发送Cookie的有效期。
	
	当省略expires属性时，其有效期仅限于维持浏览器会话(Session)时间段内。通常限于浏览器应用程序被关闭之前。



	服务端不存在可以显示删除Cookie的方法，但可通过覆盖已过期的Cookie，实现对客户端Cookie的实质性删除操作

#### path属性

	限制指定Cookie的发送范围的文件目录。

#### domain属性

	通过其指定域名可做到与结尾匹配一致。比如指定exmaple.com, 那么额外的www.example.copm或www2.example.com等都可以发送Cookie。

#### secure属性

	用于限制Web页面仅在HTTPS安全连接时，才可以发送Cookie。

#### HttpOnly属性

	是Cookie的扩展功能，使JavaScript脚本无法获得Cookie。

![](https://pic.imgdb.cn/item/5f38fcf614195aa5944df71a.jpg)

### 6.7.2 Cookie

	告知服务器，，当客户端向获得HTTP状态管理支持时，就会在请求中包含从服务器接收到的Cookie。

## 6.8 其他首部字段。

	HTTP首部字段是可以自行扩展的。
	
	就一些最常用的进行说明。

### 6.8.1 X-Frame-Options

	响应首部。
	
	用于控制网站内容在其他Web网站的Frame标签内显示问题。主要是为了防止点击劫持攻击。
	
	值：

* DENY:拒绝
* SAMEORIGIN: 仅在同源域名下的页面匹配时许可。



	在所有的Web服务器端预先设定好X-Frame-Options字段是最理想的状态。



### 6.8.2 X-XSS-Protection

	响应首部。
	
	针对跨站脚本攻击(XSS)的一种对策，控制浏览器XSS防护机制的开关。
	
	值:

* 0:XSS过滤设置为无效状态
* 1:XSS过滤设置为有效状态

### 6.8.3 DNT

	请求首部。
	
	意味拒绝个人信息被收集，是表示拒绝被精准广告追踪的一个方法。
	
	值:

*  0: 同意被追踪
* 1: 拒绝被追踪



### 6.8.4 P3P

	响应首部。
	
	通过P3P技术，可以让Web网站上的个人隐私变成一种仅供程序可理解的形式，以达到保护用户隐私的目的。
	
	需按一下步骤进行:

1. 创建P3P隐私
2. 创建P3P隐私对照文件，保存在/w3c/p3p.xml
3. 从P3P隐私中新建Compact policies，输出到HTTP响应中。

> **协议中对X-前缀的废除**
>
> 在RFC 6638中建议停止X-的做法。

# 第7章 确保Web安全的HTTPS

## 7.1 HTTP的缺点

* 通信用明文，可能会被窃听
* 不验证通信方身份，可能遭遇伪装
* 无法验证报文完整性，可能遭受串改。



### 7.1.1 通信使用明文可能会被窃听

	* 加密处理防止被窃听
	* 通信加密(SSL或 TSL)
	* 内容加密

### 7.1.2 不验证身份可能遭遇为伪装

 * **任何人都可以发起请求**

   	* 无法确定发送至目标的Web服务器是否是按真实意图返回响应的那台
      	* 无法确定客户端是否是按真实意图接收响应那个
      	* 无法确定正在通信的对方是否具备访问权限。
         	* 无法判断请求来自何方、出自谁手。
   	* 即使是无意义的请求也会照单全收，无法阻止海量请求下的DoS攻击

* **查明对手的证书**

  SSL可以确定通信方。

  证书由第三方机构颁发。

  

### 7.1.3 无法证明报文完整性

 * **接收到的内容可能有误**

 * **如何防止篡改**

   常用是MD5和SHA-1，PGP创建的数字签名。

## 7.2 HTTP+加密+认证+完整性保护=HTTPS

### 7.2.1 HTTP加上加密处理和认证以及完整性保护后即是HTTPS

​	![](https://pic.imgdb.cn/item/5f3a9ed514195aa594b25355.jpg)

### 7.2.2 HTTPS是身披SSL外壳的HTTP

​	采用SSL后，HTTP就有了HTTPS的加密，证书和完整性保护等功能。

### 7.2.3 相互交换密钥的公开密钥技术

​	SSL采用一种叫做公开密钥加密的加密处理方式。

 * **共享密钥的困境**

   ![](https://pic.imgdb.cn/item/5f3aa3d114195aa594b38281.jpg)

   

* **使用两把密钥的公开密钥加密**

  使用一堆非对称的密钥。一把叫私有密钥，一把叫公有密钥。

* **HTTPS采用混合加密机制**



### 7.2.4 证明公开密钥正确性的整数

​	无法证明公开密钥本身就是真正的公开密钥。

​	为了解决上述问题，可以使用由数字整数机构和其相关机关颁发的公开密钥整数。



![](https://pic.imgdb.cn/item/5f3aa45f14195aa594b3a00c.jpg)



* **用以确认客户端的客户端整数**

  HTTPS还可以使用客户端证书。

* **认证机构信誉第一**

  如果机构伪造整数就会蒙受损失

* **由自认证机构颁发的整数称为自签名整证书**

  每个人都可以构建一套属于自己的机构（OpenSSL)，但是该证书在互联网上不可作为证书使用。

  

### 7.2.5 HTTPS的安全通信机制

​	通信步骤

![](https://pic.imgdb.cn/item/5f3be32f14195aa594109b69.jpg)

#### 步骤1

​	客户端发送ClientHello报文开始SSL通信。

​	报文包含SSL版本，加密组件列表(所使用的的加密算法和密钥长度等)。

#### 步骤2

​	服务器可进行SSL通信时，会议Server Hello报文作为应答。

#### 步骤3

​	服务器发送Certificate报文。报文包含公开密钥整数。

#### 步骤4

​	服务器发送Server Hello Done报文通知客户端，最初阶段的SSL握手协商部分结束。

#### 步骤5

​	SSL第一次握手结束后，客户端以Client Key Exchange报文作为回应。

​	包含通信加密中被称为Pre-Master secret的随机密码串。

#### 步骤6

​	客户端发送Change Cipher Spec报文。

​	会提示服务器，在此报文之后的通信会采用Pre-master secret加密。

#### 步骤7

​	客户端发送Finished报文。包含连接至今全部豹纹的整体校验值，是否能解密该报文是握手协商成功的标准。

#### 步骤8

​	服务器同样发送Change Cipher Spec报文。

#### 步骤9

​	服务器同样发送Finished报文。

#### 步骤10

​	服务器和客户端Finished报文交换完毕后，SSL连接就算建立完成。从此处开始进行应用层协议的通信。

#### 步骤11

​	应用层协议通信，即发送HTTP响应

#### 步骤12

​	最后由客户端断开连接。断开时发送close_notify报文。这部最后再发送TCP FIN报文来关闭与TCP的通信

![](https://pic.imgdb.cn/item/5f3be71614195aa59412ec67.jpg)

* **SLL 后台TSL **

  https使用这两个协议。自主流版本是SSL3.0和TLS1.0



* **SSL速度慢么**

  HTTPS要比HTTP慢2到100倍。

  SSL慢分为通信慢和大量消耗CPU以及内存等资源，导致处理速度变慢。

# 第8章 确认访问用户的身份认证

## 8.1 何为认证

​	认证一般指需要核对"登陆者本人才知道的信息"

​	通常指：

* 密码
* 动态令牌
* 数字整数
* 生物认证
* IC卡

**HTTP使用的认证方式**

* BASIC认证(基本认证)
* DIGEST认证（摘要认证）
* SSL客户端认证
* FormBase认证（基于表单认证）

此外还有Windows统一认证



## 8.2 BASIC认证

![](https://pic.imgdb.cn/item/5f3beaab14195aa59415715a.jpg)



​	BASIC认证不需要任何附加信息即可对其进行解码。被盗的可能性很高。

​	另外，一般的浏览器无法实现认证注销操作。

## 8.3 DIGEST认证

![](https://pic.imgdb.cn/item/5f3beb0814195aa59415bc19.jpg)



![](https://pic.imgdb.cn/item/5f3bec4a14195aa59416bfcc.jpg)



	* 响应首部字段WWW-Authenticate内必须包含realm和nonce这两个字段。



​	DIGEST虽然安全等级比BASIC高，但是和HTTPS客户端认证相比仍然很弱。

​	提供了防窃听，但是没有防止用户伪装的保护机制。

## 8.4 SSL客户端认证

​	如果ID和密码被盗，就有可能被第三者冒充。利用SSL客户端认证就可以避免该情况的发生。服务器可确认访问是否来自已登录的客户端。

### 8.4.1  SSL 客户端认证的认证步骤

#### 步骤1

​	接收到需要认证资源的请求，服务器发送Certificate Request报文，要求客户端提供客户端证书。

#### 步骤2

​	客户端会把客户端证书以Client Certificate报文方式发送给服务器。

#### 步骤3

​	客户端证书通过后，可领取证书内客户端的公开密钥，然后开始HTTPS加密通信

### 8.4.2 SSL客户端认证采用双因素认证

​	一般会和表单认证组合形成一种双因素认证。

### 8.4.3 SSL客户端认证必要的费用

​	客户端认证需要支付一定费用才能使用。

## 8.5 基于表单认证

​	不是在HTTP协议中定义的。客户端会发送登录信息，按登录信息的验证结果认证。

### 8.5.1 认证多半为基于表单认证

​	略

### 8.5.2 Session管理及Cookie应用

​	基于表单认证的标准规范尚未有定论，一般会使用Cookie来管理Session。

​	![](https://pic.imgdb.cn/item/5f3d29a514195aa594b8b550.jpg)



​	另外，为减轻跨站脚本攻击(XSS)造成的损失，建议事先在Cookie内加上httponly属性。

# 第9章 基于HTTP的功能追加协议

## 9.1 基于HTTP的协议	

​	HTTP功能有些限制，以及自身性能有限。但是无法完全抛弃HTTP。有一些新协议的规则是基于HTTP的，并在此基础上添加了新的功能。

## 9.2 消除HTTP瓶颈的SPDY

​	Google 2010年发布SPDY，旨在解决HTTP的性能瓶颈，缩短Web页面的加载时间

### 9.2.1 HTTP的瓶颈

​	实时更新大量的内容，HTTP无法拓展的处理好这项任务。如果用HTTP协议探知服务器上是否有内容更新，就必须频繁地从客户端到服务端进行确认。如果没有，就会产生徒劳的通信。

​	以下HTTP标准就会成为瓶颈：

* 一条连接上只可发送一个请求
* 请求只能从客户端开始。客户端不可以接收响应以外的指令。
* 请求/响应首部未经亚索就发送，请求信息越多延迟越大。
* 发送冗长的首部。每次互相发送相同的首部造成的浪费比较多
* 可任意选择数据压缩格式。非强制压缩发送。



#### Ajax的解决办法

​	它是局部Web页面替换加载的异步通信手段。

​	核心结束时名为XMLHttpRequest的API，通过JavaScript脚本的就调用就能和服务器进行HTTP通信。

​	利用Ajax实时地从服务器获取内容，有可能会导致大量请求的发生。但是Ajax没仍未解决HTTP协议本身存在的问题。

![](https://pic.imgdb.cn/item/5f426126160a154a67697e83.jpg)

#### Comet的解决办法。

​	一旦服务器有内容更新，Comet不会让请求等待，而是直接给客户端返回响应。这是中通过延迟应答，模拟实现服务器端向客户端推送的功能。

​	为了实现推送功能，Comet会先将响应置于挂起状态，当服务器有内容更新时，再返回该响应。

​	但是为了保留响应，一次连接的持续时间也变长了。会消耗更多的资源，仍未解决HTTP协议本身存在的问题。

![](https://pic.imgdb.cn/item/5f42634a160a154a676a52ac.jpg)



#### SPDY的目标

​	处于持续开发状态中的SPDY协议，正是为了在协议级别消除HTTP所遭遇的瓶颈。

### 9.2.2 SPDY的设计与功能

​	SPDY没有完全改写HTTP协议，而是在TCP/IP的应用层和传输层之间通过新加会话层的形式运作。同时，考虑到安全问题，SPDY规定通信中使用SSL。

​	![](https://pic.imgdb.cn/item/5f42647b160a154a676ac9a5.jpg)

​	SPDY以会话层形式加入，控制对数据的流动，还是采用HTTP建立听信连接。所以可以照常使用HTTP的GET和POST方法。

​	使用SPDY后，HTTP协议额外获得以下功能。

#### 	多路复用

​	通过单一的TCP连接，可以无限制处理多个HTTP请求，都是在一条TCP连接完成，处理效率得到提高。

#### 	赋予请求优先级

​	可以逐个分配优先顺序。

#### 	压缩HTTP首部

​	减少通信产生的数据包数量和发送字节数。

#### 	推送功能

​	支持服务器主动向客户端推送数据。

#### 	服务器提示功能

​	可以主动提示客户端请求所需的资源。

### 9.2.3 SPDY消除Web瓶颈了吗

​	Web内容端不必做特别改动，但是浏览器和Web服务器都要做一定程度改动。

​	但是把该技术导入实际的Web网页进展不佳。SPDY基本上只是将单个域名(IP地址)的通信多路复用，所以Web网站上使用多个域名下的资源，改善效果就会受到限制。但是它确实是一种可有效消除HTTP瓶颈的技术。

## 9.3 使用浏览器进行全双工通信的WebSocket

​	WebSocket网络技术为了解决HTTP瓶颈问题而实现的一套新协议以及API。

### 9.3.1 WebSocket的设计与功能

​	仍在进行开发，为了解决Ajax和Comet里XMLHttpRequest附带的缺陷所引起的问题。

### 9.3.2 WebSocket协议

​	一旦建立WebSocket通信连接，之后所有通信都依靠这个专用协议。通信过程中可以发送任意格式的数据。

​	任意一方都可以直接向对方发送报文。

#### 	推送功能

​	支持推送功能

#### 	减少通信量

​	WebSocket的头部很小。

​	为了实现WebSocket通信，HTTP建立之后，需要完成一次握手的步骤。

* **握手 · 请求**

  为了实现WebSocket通信，需要用到HTTP的Upgrade首部字段，告知服务器通信协议发生改变以达到握手的目的。

  ![](https://pic.imgdb.cn/item/5f426880160a154a676c360f.jpg)

  ![](https://pic.imgdb.cn/item/5f426890160a154a676c3b75.jpg)



* **握手 · 响应 **

  相对于之前的请求，返回状态码101 Switching Protocols的响应。

  ![](https://pic.imgdb.cn/item/5f4268d3160a154a676c5089.jpg)

![](https://pic.imgdb.cn/item/5f4268e6160a154a676c594e.jpg)



## 9.4 期盼已久的HTTP/2.0

#### HTTP/2.0的特点。

​	其目标是改善用户在使用Web时的速度体验。

基于以下协议讨论HTTP/2.0

![](https://pic.imgdb.cn/item/5f426a95160a154a676ce2db.jpg)

#### HTTP/2.0的7项技术及讨论

![](https://pic.imgdb.cn/item/5f426a71160a154a676cd62e.jpg)

![](https://pic.imgdb.cn/item/5f426a7e160a154a676cda59.jpg)

## 9.5 Web服务器管理文件的WebDAV

​	是一个可对Web服务器上的内容直接进行文本复制、编辑等操作的分布式系统。

![](https://pic.imgdb.cn/item/5f426aeb160a154a676cfc9a.jpg)

### 9.5.1 扩展HTTP/1.1的WebDAV

​	新增以下概念。

![](https://pic.imgdb.cn/item/5f426b0e160a154a676d08fc.jpg)

### 9.6.2 WebDAV内新增的方法以及状态码

​	追加了如下方法：

**PROPFIND** ：获取属性。

**PROPPATCH** ：修改属性 

**MKCOL** ：创建集合 

**COPY** ：复制资源及属性 

**MOVE** ：移动资源 

**LOCK** ：资源加锁 

**UNLOCK** ：资源 解 锁

新增了如下状态码：

**102 Processing** ：可正常处理请求， 但目前是处理中状态 

**207 Multi- Status** ：存在多种状态 

**422 Unprocessible Entity** ：格式正确，内容有误 

**423 Locked** ：资源已被加锁 

**424 Failed Dependency** ：处理与某请求关联的请求失败， 因此不再维持依赖关系 

**507 Insufficient Storage** ：保存空间不足



# 第10章 构建Web内容的技术

## 10.1 HTML

### 10.1.1 Web页面几乎全由HTML构建

​	它是为了发送Web的超文本开发的标记语言。我们浏览的Web页面几乎全是使用HTML写成的。

### 10.1.2 HTML的版本

​	目前(2012)最新的版本是HTML4.01标准。2014年左右正式使用HTML5标准。

### 10.1.3 设计应用CSS

​	CSS可以制动如何展现HTML内的各种元素。理念就是文档结构和设计分离，达到解耦的目的。

## 10.2 动态HTML

### 10.2.1 让Web页面动起来的动态HTML

​	通过调用客户端脚本语言JavaScript实现对Web页面的动态改造。

### 10.2.2 更勇于控制HTML的DOM

​	它是用以操作HTML文档和XML文档的API。

## 10.3 Web应用

### 10.3.1 通过Web提供的web应用

​	Web应用是指通过Web功能提供的应用程序。

### 10.3.2 与Web服务器及程序协作的CGI

​	是指Web服务器在接收到客户端发送过来的请求转发给程序的一种机制。

​	![](https://pic.imgdb.cn/item/5f426d9a160a154a676dfb5c.jpg)



### 10.3.3 因Java而普及的Servlet

​	是一种能在服务器上创建动态内容的程序。Servlet是Java语言实现的一个接口，属于面向企业级的Java的一部分。

​	CGI由于每次收到请求，程序都要跟着启动一次，要承受比较大的负载，Servlet运行在Web服务器相同的进程中，受到的负载比较小。它的运行环境造作Web荣哟或者Servlet容器。

## 10.4 数据发布的格式及语言

### 10.4.1 可扩展标记语言

​	XML。

### 10.4.2 发布更新信息的RSS/Atom

​	都是发布新闻或者博客日志等更新信息文档的格式的总称。

### 10.4.3 JavaScript衍生的轻量级易用Json

​	略。

# 第11章 Web的攻击技术

## 11.1 针对Web的攻击技术

​	协议本身不存在安全性问题，但是应用HTTP协议的服务器和客户端以及运行在服务器上的Web应用等资源才是攻击目标。

​	![](https://pic.imgdb.cn/item/5f426ff6160a154a676ee6bb.jpg)

### 11.1.1 HTTP不具备必要的安全功能

​	几乎现今所有的Web网站都是用会话管理，加密处理等安全性方面的功能，但是HTTP协议内并不具备这些功能。所以再安全性方便呈劣势。

### 11.1.2 在客户端即可转改请求。

​	可以通过URL查询字段、表单、HTTP首部、Cookie等途径把攻击代码传入。

### 11.1.3 针对Web应用的攻击模式

* 主动攻击
* 被动攻击



* **以服务器为目标的主动攻击**

  比如SQL注入、OS命令注入。

* **以服务器为目标的被动攻击**

  指利用去拿套策略执行攻击代码的攻击模式。比如跨站脚本攻击和跨站点请求伪造。

![](https://pic.imgdb.cn/item/5f427102160a154a676f57b3.jpg)

## 11.2 因输出值转移不完全引发的安全漏洞

​	安全对策大致分为以下两部分

* 客户端的验证
* Web应用端的验证
  * 输入值验证
  * 输出值转义



​	客户端验证只是为了尽早地辨识出输入错误，提高UI体验。



### 11.2.1 跨站脚本攻击

​	指通过存在安全漏洞Web网站注册用户的浏览器内运行非法的HTML标签或JavaScript的一种攻击。

​	可能造成以下影响：

* 利用虚假输入表单骗取用户个人信息
* 利用脚本窃取用户的Cookie值，被害者在不知情的情况下，帮助攻击者发送恶意请求
* 显示伪造的文章或图片



### 11.2.2 SQL注入攻击

* 会执行非法的SQL的SQL注入攻击

可能造成以下影响：

* 非法查看或串改数据库内的数据
* 规避认证
* 执行和数据库服务器业务相关的程序。



### 11.2.3 OS命令注入攻击

​	是指通过Web应用，执行非法的操作系统命令达到攻击的目的。



### 11.2.4 HTTP首部注入攻击

​	是指攻击者在响应首部字段内插入换行，添加任意响应首部或主体的攻击，属于被动攻击。

​	可能造成如下影响

* 设置任何Cookie信息
* 重定向任意URL
* 显示任意主体

### 11.2.5 邮件首部注入攻击

​	是指web应用中的邮件发送功能，攻击者通过向邮件首部To或Subject内任意添加非法内容发起的攻击。

### 11.2.6 目录遍历攻击

​	是指对本无意公开的文件目录，通过非法截取其目录路径后，达成访问目的的一种攻击。

### 11.2.7 远程文件包含漏洞

​	是指当部分脚本内容需要从其他文件读入时，供给制利用外部服务器的URL充当依赖文件，让脚本读取之后，就可以运行任意脚本的一种攻击。

​	主要是PHP存在的潜安全漏洞。PHP5.2.0之后默认设定此功能无效。



## 11.3 因设置或设计上的缺陷引发的安全漏洞

​	至错误设计Web服务器或者是由设计上的一些问题引发的漏洞

### 11.3.1 强制浏览

​	指从安置在Web服务器公开目录下的文件中，浏览哪些原本非自愿公开的文件。

* 泄漏顾客的个人信息等重要情报
* 泄漏原本需要具有权限访问用户才可查阅的信息内容
* 谢罗未外连到外界的文件。

### 11.3.2 不正确的错误消息处理

​	Web应用错误信息内包含对攻击者有用的信息。

* Web应用爆出错误信息
* 数据库等系统抛出的错误信息



### 11.3.3 开放重定向

​	会有道用户去到具有恶意的某个网站。

## 11.4 因会话管理疏忽引发的安全漏洞

### 11.4.1 会话劫持

​	攻击者以某种手段拿到了用户的会话ID，并非法使用ID伪装成用户，达到攻击目的。

* 通过非正规的生成方法推测会话ID
* 通过窃听或XSS攻击盗取会话ID
* 通过会话固定攻击强行获取会话ID

### 11.4.2 会话固定攻击

​	强制用户使用攻击者指定的会话ID,属于被动攻击。

![](https://pic.imgdb.cn/item/5f427575160a154a677141ad.jpg)



#### Session Adoption

​	指PHP或者让ASP.NET能够接受处理未知会话ID的功能。

### 11.4.3 跨站点请求伪造

​	指攻击者通过设置好的陷阱，强制对已完成认证的用户进行非预期的个人信息或者设定信息等某些状态的功更新。属于被动攻击。

* 利用已通过认证的用户权限更新设定信息的等
* 利用已通过认证的用户权限购买商品
* 利用已通过认证的用户权限在留言板发表言论



## 11.5 其他安全漏洞

### 11.5.1 密码破解

​	算出密码，突破认证。

### 11.5.2 点击劫持

​	指利用透明的按钮或链接做成陷阱，覆盖在Web页面纸上。然后诱使用户在不知情的情况下，点击那个链接访问内容的一种攻击手段。又称为界面伪装。

### 11.5.3 Dos攻击

​	一种让运行中的服务呈停止状态的攻击。

* 集中利用访问请求造成资源过载，资源用尽的同时，实际上服务也就呈停止状态
* 通过攻击安全漏洞使服务停止。

### 11.5.4 后门程序

​	指开发设置的隐藏入口，可不按正常步骤使用受限功能。

* 开发阶段作为Debug调用的后门程序
* 开发者为了自身利益植入的后门程序
* 攻击者通过某种方法设置的后门程序

​	

